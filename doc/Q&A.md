# Q&A

> [全体の目次に戻る](../README.md)

## 目次

- [目次](#目次)
- [データが存在しない・不足している場合](#データが存在しない不足している場合)
  - [支払情報（支払予定日、支払先名、…）が空欄です。](#支払情報支払予定日支払先名が空欄です)
  - [特定の申請書に対応する仕訳情報（fix\_journals）が存在しません。](#特定の申請書に対応する仕訳情報fix_journalsが存在しません)

## データが存在しない・不足している場合

### 支払情報（支払予定日、支払先名、…）が空欄です。

（2024/10/07 更新）

　フォーム形式が**支払依頼**である申請書には、支払依頼項目の中に**支払日**や**取引先名**などの項目があります。ジョブカン経費精算/ワークフローAPI（β版）（以下、API）では請求書に関するエンドポイント（取得手段、**申請書詳細情報**等）を提供していますが、これらのエンドポイントからは支払情報を直接取得することができません。そのため、本アプリケーションでは以下の方法で支払情報を取得しています：

1. **確定済み未出力仕訳情報一覧 v1** エンドポイント（`/v1/fix_journals/unprinted/`）を使用
2. 取得したデータの中から `journal_type` が `"pay"` であるものを抽出
3. 抽出したデータの `journal_date` から「支払(予定)日」を、`company_code` や `invoice_registrated_number` などから支払先の情報を取得

しかし、この方法には以下の制限があります：

- **未確定の仕訳情報は取得不可能**: 新しい申請書の場合、仕訳情報が確定されるまでAPIで取得できません。
- **出力済みの仕訳情報は取得不可能**: 古い申請書の場合、仕訳情報が出力された後であればAPIで取得できません。

これらの制限により、以下のような状況で支払情報が空欄になる可能性があります：

1. 申請書が新しく、仕訳情報がまだ確定されていない場合
2. 申請書が古く、仕訳情報が既に出力済みの場合
3. 仕訳情報の確定処理が完了していない場合

**対処方法**:

現状のAPIの制約上、これらの問題を完全に解決することは困難です。一時的な対処として以下の方法を提案します：

- ジョブカンの管理画面で直接支払情報を確認する
- ジョブカン側からCSVを取得して参照する

この方法では、本ソフトウェアでの直接的な対処は不可能であり、特に当月などの新しい支払情報は取得できないことにご注意ください。また、フォーム形式が「支払依頼」の場合、この方法では経理業務の使用に十分な情報が得られない可能性があります。

長期的な解決策としては、ジョブカンのAPI機能の拡張が必要です。特に以下の点について改善が望まれます：

- 未確定の仕訳情報を取得できるエンドポイントの追加
- 出力済みの仕訳情報を取得できるエンドポイントの追加
- 申請書詳細情報エンドポイントでの支払情報（支払予定日、支払先名等）の直接提供

これらの機能が実装されれば、より正確かつ包括的な支払情報の管理が可能になり、本アプリケーションの機能も大幅に向上すると考えられます。

### 特定の申請書に対応する仕訳情報（fix_journals）が存在しません。

（2024/10/05 更新）

　ジョブカン経費精算/ワークフローAPI（β版）（以下、API）では、取得することの可能な仕訳情報は**確定済み**かつ**未出力**のものに限られます<sup>*1</sup>。そのため、「経費精算機能」の「仕訳確定・出力する」画面に表示されている仕訳（＝未確定の仕訳情報）や、CSVとして出力済みの仕訳情報は取得できません。

<img src="https://jobcanwf.zendesk.com/hc/article_attachments/5986418799129/___-_________-____.PNG" alt="ジョブカン経費精算 仕訳確定・出力画面" width=75%>

　このようなAPIの仕様により、特定の申請書に対応する仕訳情報が存在しない場合、以下のいずれかが考えられます。

1. **未確定の仕訳情報である**
   - ⇒ 新しい申請書の場合、仕訳情報が確定されるまでAPIで取得できません。
2. **出力済みの仕訳情報である**
   - ⇒ 古い申請書の場合、仕訳情報が出力された後であればAPIで取得できません。

> *1: APIの提供する仕訳情報のためのエンドポイント（取得手段）は **確定済み未出力仕訳情報一覧 v1**（`/v1/fix_journals/unprinted/`）のみです。このため、未確定の仕訳情報や、確定済みであっても出力済みの仕訳情報は取得できません。

---

> [全体の目次に戻る](../README.md)
